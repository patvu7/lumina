<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="theme-color" content="#1a1a1a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Lumina - Verified</title>
    <style>
/* ============================================
   DESIGN TOKENS
   ============================================ */
:root {
    /* Colors */
    --bg-primary: #1a1a1a;
    --bg-secondary: #242424;
    --bg-tertiary: #2a2a2a;
    --text-primary: #f5f5f5;
    --text-secondary: #888;
    --text-muted: #666;
    
    /* Borders */
    --border-subtle: rgba(255,255,255,0.06);
    --border-light: rgba(255,255,255,0.08);
    --border-medium: rgba(255,255,255,0.1);
    --border-strong: rgba(255,255,255,0.15);
    
    /* Accents */
    --accent-gold: #E8B84A;
    --accent-green: #22C55E;
    
    /* Shadows */
    --shadow-card: 0 2px 8px rgba(0,0,0,0.3), 0 8px 24px rgba(0,0,0,0.4), 0 24px 48px rgba(0,0,0,0.3);
    
    /* Radii */
    --radius-sm: 8px;
    --radius-md: 10px;
    --radius-lg: 12px;
    
    /* Sizing */
    --touch-target: 44px;
    
    /* Transitions */
    --transition-fast: 0.15s ease;
    --transition-medium: 0.2s ease;
}

/* ============================================
   RESET & BASE
   ============================================ */
* { margin: 0; padding: 0; box-sizing: border-box; }

html, body {
    min-height: 100%;
    min-height: -webkit-fill-available;
    background: var(--bg-primary);
    font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'SF Pro Text', system-ui, sans-serif;
    color: var(--text-primary);
    -webkit-tap-highlight-color: transparent;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

@media (prefers-reduced-motion: reduce) {
    *, *::before, *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
    }
}

/* ============================================
   HEADER
   ============================================ */
.header {
    position: sticky;
    top: 0;
    height: 56px;
    padding: 0 16px;
    padding-top: env(safe-area-inset-top);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 300;
    background: var(--bg-primary);
    border-bottom: 1px solid var(--border-subtle);
}

.header-btn {
    position: absolute;
    width: var(--touch-target);
    height: var(--touch-target);
    display: flex;
    align-items: center;
    justify-content: center;
    border: none;
    background: transparent;
    cursor: pointer;
    border-radius: 50%;
    transition: background var(--transition-fast);
}

.header-btn:hover,
.header-btn:focus-visible { background: rgba(255,255,255,0.08); }
.header-btn:focus-visible { outline: 2px solid var(--accent-gold); outline-offset: 2px; }
.header-btn svg { width: 22px; height: 22px; color: var(--text-primary); }

.back-btn { left: 8px; }
.share-btn { right: 8px; }
.wordmark { font-size: 18px; font-weight: 600; letter-spacing: 0.02em; color: var(--text-primary); }

/* ============================================
   LAYOUT
   ============================================ */
.main-container {
    max-width: 960px;
    margin: 0 auto;
    padding: 24px 16px 48px;
    padding-bottom: calc(48px + env(safe-area-inset-bottom));
    display: flex;
    flex-direction: column;
    gap: 24px;
}

@media (min-width: 768px) {
    .main-container {
        flex-direction: row;
        align-items: flex-start;
        gap: 32px;
        padding: 32px 24px 48px;
    }
}

/* ============================================
   CARD VIEWER
   ============================================ */
.card-section {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 16px;
}

@media (min-width: 768px) {
    .card-section {
        position: sticky;
        top: 80px;
    }
}

.card-wrapper {
    position: relative;
    width: min(260px, 65vw);
    aspect-ratio: 1340 / 1864;
    border-radius: var(--radius-lg);
    overflow: hidden;
    touch-action: none;
    box-shadow: var(--shadow-card);
    background: var(--bg-tertiary);
    -webkit-user-select: none;
    user-select: none;
}

@media (min-width: 768px) {
    .card-wrapper { width: 280px; }
}

.card-canvas {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    transform-origin: center center;
    will-change: transform;
}

.card-canvas.animating {
    transition: transform 0.1s ease-out;
}

.card-layer {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    object-fit: cover;
    pointer-events: none;
    -webkit-user-drag: none;
    will-change: opacity;
}

.layer-base { z-index: 1; }
.layer-north { z-index: 2; opacity: 0; }
.layer-south { z-index: 3; opacity: 0; }
.layer-east { z-index: 4; opacity: 0; }
.layer-west { z-index: 5; opacity: 0; }

.card-placeholder {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 12px;
    background: linear-gradient(145deg, var(--bg-secondary), var(--bg-tertiary));
    color: var(--text-muted);
    z-index: 0;
}

.card-placeholder svg { width: 48px; height: 48px; opacity: 0.5; }
.card-placeholder span { font-size: 13px; }

.card-controls {
    display: flex;
    gap: 8px;
}

.card-control-btn {
    width: var(--touch-target);
    height: var(--touch-target);
    display: flex;
    align-items: center;
    justify-content: center;
    border: none;
    background: var(--bg-secondary);
    cursor: pointer;
    border-radius: var(--radius-md);
    border: 1px solid var(--border-light);
    transition: background var(--transition-fast);
}

.card-control-btn:hover,
.card-control-btn:focus-visible { background: var(--bg-tertiary); }
.card-control-btn:focus-visible { outline: 2px solid var(--accent-gold); outline-offset: 2px; }
.card-control-btn svg { width: 18px; height: 18px; color: var(--text-secondary); }
.card-control-btn:hover svg { color: var(--text-primary); }

.zoom-hint {
    font-size: 12px;
    color: var(--text-muted);
    text-align: center;
    display: none;
}

@media (max-width: 767px) and (hover: none) {
    .zoom-hint { display: block; }
}

/* ============================================
   DETAILS SECTION
   ============================================ */
.details-section {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 16px;
    min-width: 0;
}

/* Verification Card */
.verification-card {
    background: linear-gradient(135deg, rgba(34, 197, 94, 0.1) 0%, rgba(34, 197, 94, 0.05) 100%);
    border: 1px solid rgba(34, 197, 94, 0.25);
    border-radius: var(--radius-lg);
    padding: 20px;
}

.verification-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 16px;
}

.verification-icon {
    width: 44px;
    height: 44px;
    background: rgba(34, 197, 94, 0.2);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}

.verification-icon svg {
    width: 24px;
    height: 24px;
    color: var(--accent-green);
}

.verification-title {
    font-size: 16px;
    font-weight: 600;
    color: var(--accent-green);
}

.verification-subtitle {
    font-size: 13px;
    color: var(--text-secondary);
    margin-top: 2px;
}

.timestamp-display {
    background: rgba(0,0,0,0.3);
    border-radius: var(--radius-sm);
    padding: 12px 16px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.timestamp-display svg {
    width: 18px;
    height: 18px;
    color: var(--accent-green);
    flex-shrink: 0;
}

.timestamp-text {
    font-size: 14px;
    color: var(--text-primary);
}

.timestamp-label {
    font-size: 12px;
    color: var(--text-secondary);
    display: block;
    margin-bottom: 2px;
}

/* Info Cards */
.info-card {
    background: var(--bg-secondary);
    border-radius: var(--radius-lg);
    padding: 20px;
    border: 1px solid var(--border-light);
}

.info-card.hidden { display: none; }

.info-card-title {
    font-size: 11px;
    font-weight: 600;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: 12px;
}

.card-title {
    font-size: 22px;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 4px;
    word-break: break-word;
}

.card-subtitle {
    font-size: 14px;
    color: var(--text-secondary);
}

.info-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 0;
    border-top: 1px solid var(--border-subtle);
    gap: 16px;
}

.info-row:first-of-type { margin-top: 16px; }
.info-row.hidden { display: none; }

.info-label {
    font-size: 13px;
    color: var(--text-muted);
    flex-shrink: 0;
}

.info-value {
    font-size: 13px;
    color: var(--text-primary);
    font-weight: 500;
    text-align: right;
    word-break: break-word;
}

.grade-badge {
    display: inline-flex;
    padding: 4px 10px;
    background: rgba(232, 184, 74, 0.15);
    border: 1px solid rgba(232, 184, 74, 0.3);
    border-radius: 6px;
    font-size: 12px;
    font-weight: 600;
    color: var(--accent-gold);
}

/* Notes Card */
.notes-card {
    background: var(--bg-secondary);
    border-radius: var(--radius-lg);
    padding: 20px;
    border: 1px solid var(--border-light);
}

.notes-card.hidden { display: none; }

.notes-title {
    font-size: 11px;
    font-weight: 600;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: 10px;
}

.notes-text {
    font-size: 14px;
    color: #ccc;
    line-height: 1.6;
    white-space: pre-wrap;
    word-break: break-word;
}

/* Links Card */
.links-card {
    background: var(--bg-secondary);
    border-radius: var(--radius-lg);
    padding: 20px;
    border: 1px solid var(--border-light);
}

.links-card.hidden { display: none; }

.links-title {
    font-size: 11px;
    font-weight: 600;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: 12px;
}

.links-grid {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.link-btn {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 14px 16px;
    min-height: var(--touch-target);
    background: var(--bg-primary);
    border: 1px solid var(--border-medium);
    border-radius: var(--radius-md);
    text-decoration: none;
    color: var(--text-primary);
    font-size: 14px;
    font-weight: 500;
    transition: all var(--transition-fast);
}

.link-btn:hover,
.link-btn:focus-visible {
    background: #222;
    border-color: rgba(255,255,255,0.2);
}

.link-btn:focus-visible { outline: 2px solid var(--accent-gold); outline-offset: 2px; }
.link-btn.hidden { display: none; }
.link-btn svg { width: 20px; height: 20px; color: var(--text-secondary); flex-shrink: 0; }
.link-btn span { flex: 1; }
.link-btn .link-arrow { width: 16px; height: 16px; color: var(--text-muted); }

/* Fingerprint Hint */
.fingerprint-hint {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    padding: 14px 16px;
    background: rgba(255,255,255,0.03);
    border-radius: var(--radius-md);
    border: 1px solid var(--border-subtle);
}

.fingerprint-hint svg {
    width: 20px;
    height: 20px;
    color: var(--text-muted);
    flex-shrink: 0;
    margin-top: 1px;
}

.fingerprint-hint-text {
    font-size: 13px;
    color: var(--text-secondary);
    line-height: 1.5;
}

/* ============================================
   OVERLAYS & INDICATORS
   ============================================ */
.light-glow {
    position: fixed;
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background: radial-gradient(circle, rgba(255,220,150,0.12) 0%, transparent 70%);
    pointer-events: none;
    z-index: 100;
    transform: translate(-50%, -50%);
    opacity: 0;
    transition: opacity var(--transition-fast);
}

.light-glow.visible { opacity: 1; }

.zoom-pill {
    position: fixed;
    top: 70px;
    left: 50%;
    transform: translateX(-50%);
    padding: 6px 12px;
    background: var(--bg-tertiary);
    border: 1px solid var(--border-medium);
    border-radius: 16px;
    font-size: 12px;
    font-weight: 600;
    color: var(--text-primary);
    z-index: 200;
    opacity: 0;
    pointer-events: none;
    transition: opacity var(--transition-medium);
}

.zoom-pill.visible { opacity: 1; }

.toast {
    position: fixed;
    bottom: 100px;
    left: 50%;
    transform: translateX(-50%) translateY(20px);
    padding: 12px 20px;
    background: #333;
    border-radius: var(--radius-lg);
    font-size: 14px;
    font-weight: 500;
    color: #fff;
    opacity: 0;
    pointer-events: none;
    transition: all 0.3s ease;
    z-index: 400;
}

.toast.visible {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
}

/* ============================================
   TEXTURE SLIDER
   ============================================ */
.texture-layer {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    object-fit: cover;
    pointer-events: none;
    z-index: 10;
    clip-path: inset(0 100% 0 0);
    filter: grayscale(100%) contrast(1.3) brightness(1.1);
    mix-blend-mode: luminosity;
}

.texture-slider {
    position: absolute;
    top: 0;
    left: 0;
    width: 4px;
    height: 100%;
    background: var(--accent-gold);
    z-index: 20;
    cursor: ew-resize;
    transform: translateX(-50%);
    box-shadow: 0 0 8px rgba(0,0,0,0.5);
}

.texture-slider::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 36px;
    height: 36px;
    background: var(--accent-gold);
    border-radius: 50%;
    box-shadow: 0 2px 8px rgba(0,0,0,0.4);
}

.texture-slider::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 20px;
    height: 20px;
    background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%231a1a1a' stroke-width='2.5'%3E%3Cpath d='M18 8l4 4-4 4M6 8l-4 4 4 4'/%3E%3C/svg%3E") center/contain no-repeat;
}

.texture-slider-track {
    position: absolute;
    bottom: 12px;
    left: 12px;
    right: 12px;
    height: 32px;
    background: rgba(0,0,0,0.6);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    border-radius: 16px;
    z-index: 15;
    display: flex;
    align-items: center;
    padding: 0 12px;
    gap: 8px;
    opacity: 0;
    transition: opacity var(--transition-medium);
    pointer-events: none;
}

.card-wrapper:hover .texture-slider-track,
.card-wrapper.slider-active .texture-slider-track {
    opacity: 1;
    pointer-events: auto;
}

@media (hover: none) {
    .texture-slider-track {
        opacity: 1;
        pointer-events: auto;
    }
}

.texture-label {
    font-size: 10px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--text-secondary);
    white-space: nowrap;
}

.texture-label.active { color: var(--accent-gold); }

.texture-track-bar {
    flex: 1;
    height: 4px;
    background: rgba(255,255,255,0.2);
    border-radius: 2px;
    position: relative;
}

.texture-track-fill {
    position: absolute;
    top: 0; left: 0;
    height: 100%;
    background: var(--accent-gold);
    border-radius: 2px;
    width: 0%;
}

/* Fullscreen button */
.fullscreen-btn {
    position: absolute;
    top: 8px;
    right: 8px;
    width: 36px;
    height: 36px;
    background: rgba(0,0,0,0.6);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    border: 1px solid rgba(255,255,255,0.15);
    border-radius: var(--radius-sm);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    z-index: 25;
    opacity: 0;
    transition: opacity var(--transition-medium), background var(--transition-fast);
}

.card-wrapper:hover .fullscreen-btn { opacity: 1; }
@media (hover: none) { .fullscreen-btn { opacity: 1; } }

.fullscreen-btn:hover { background: rgba(0,0,0,0.8); }
.fullscreen-btn:focus-visible { outline: 2px solid var(--accent-gold); outline-offset: 2px; }
.fullscreen-btn svg { width: 18px; height: 18px; color: var(--text-primary); }

/* Fullscreen overlay */
.fullscreen-overlay {
    display: none;
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: #000;
    z-index: 1000;
    flex-direction: column;
}

.fullscreen-overlay.active { display: flex; }

.fullscreen-header {
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 56px;
    padding: 0 16px;
    padding-top: env(safe-area-inset-top);
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: linear-gradient(to bottom, rgba(0,0,0,0.8) 0%, transparent 100%);
    z-index: 1010;
}

.fullscreen-title { font-size: 16px; font-weight: 600; color: var(--text-primary); }

.fullscreen-close {
    width: var(--touch-target);
    height: var(--touch-target);
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(255,255,255,0.1);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    transition: background var(--transition-fast);
}

.fullscreen-close:hover { background: rgba(255,255,255,0.2); }
.fullscreen-close:focus-visible { outline: 2px solid var(--accent-gold); outline-offset: 2px; }
.fullscreen-close svg { width: 24px; height: 24px; color: var(--text-primary); }

.fullscreen-card-area {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 60px 16px 100px;
    overflow: hidden;
}

.fullscreen-card-wrapper {
    position: relative;
    width: 100%;
    max-width: min(90vw, 600px);
    max-height: 100%;
    aspect-ratio: 1340 / 1864;
    border-radius: var(--radius-lg);
    overflow: hidden;
    touch-action: none;
    box-shadow: var(--shadow-card);
    -webkit-user-select: none;
    user-select: none;
}

@media (orientation: landscape) {
    .fullscreen-card-wrapper {
        max-width: none;
        width: auto;
        height: 100%;
        max-height: calc(100vh - 160px);
    }
}

.fullscreen-controls {
    position: absolute;
    bottom: 0; left: 0; right: 0;
    padding: 16px;
    padding-bottom: calc(16px + env(safe-area-inset-bottom));
    background: linear-gradient(to top, rgba(0,0,0,0.8) 0%, transparent 100%);
    display: flex;
    flex-direction: column;
    gap: 12px;
    z-index: 1010;
}

.fullscreen-zoom-controls {
    display: flex;
    justify-content: center;
    gap: 12px;
}

.fullscreen-zoom-btn {
    width: 48px;
    height: 48px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(255,255,255,0.1);
    border: 1px solid rgba(255,255,255,0.2);
    border-radius: var(--radius-md);
    cursor: pointer;
    transition: background var(--transition-fast);
}

.fullscreen-zoom-btn:hover { background: rgba(255,255,255,0.2); }
.fullscreen-zoom-btn svg { width: 22px; height: 22px; color: var(--text-primary); }

.fullscreen-zoom-level {
    min-width: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    font-weight: 600;
    color: var(--text-primary);
}

.fullscreen-texture-slider {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 0 8px;
}

.fullscreen-texture-slider .texture-label { font-size: 11px; }
.fullscreen-texture-slider .texture-track-bar { height: 6px; }

body.fullscreen-active {
    overflow: hidden;
    position: fixed;
    width: 100%;
    height: 100%;
}
    </style>
</head>
<body>
    <!-- ============================================
         HEADER
         ============================================ -->
    <header class="header">
        <button class="header-btn back-btn" id="back-btn" aria-label="Go back">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                <path d="M19 12H5M12 19l-7-7 7-7"/>
            </svg>
        </button>
        <span class="wordmark">Lumina</span>
        <button class="header-btn share-btn" id="share-btn" aria-label="Share">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                <circle cx="18" cy="5" r="3"/>
                <circle cx="6" cy="12" r="3"/>
                <circle cx="18" cy="19" r="3"/>
                <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/>
                <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/>
            </svg>
        </button>
    </header>

    <!-- ============================================
         MAIN CONTENT
         ============================================ -->
    <main class="main-container">
        <!-- Card Preview Section -->
        <section class="card-section" aria-label="Card preview">
            <div class="card-wrapper" id="card-wrapper" role="img" aria-label="Interactive card preview - drag to change lighting, pinch to zoom, slide to reveal texture">
                <div class="card-canvas" id="card-canvas">
                    <div class="card-placeholder" id="card-placeholder">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <rect x="3" y="3" width="18" height="18" rx="2"/>
                            <circle cx="8.5" cy="8.5" r="1.5"/>
                            <path d="M21 15l-5-5L5 21"/>
                        </svg>
                        <span>Card preview</span>
                    </div>
                    <img class="card-layer layer-base" id="layer-base" alt="" src="" loading="eager">
                    <img class="card-layer layer-north" id="layer-north" alt="" src="" loading="eager">
                    <img class="card-layer layer-south" id="layer-south" alt="" src="" loading="eager">
                    <img class="card-layer layer-east" id="layer-east" alt="" src="" loading="eager">
                    <img class="card-layer layer-west" id="layer-west" alt="" src="" loading="eager">
                    <img class="card-layer texture-layer" id="texture-layer" alt="" src="" loading="eager">
                </div>
                <div class="texture-slider" id="texture-slider" role="slider" aria-label="Texture reveal slider" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0"></div>
                <button class="fullscreen-btn" id="fullscreen-btn" aria-label="Enter fullscreen mode">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/>
                    </svg>
                </button>
                <div class="texture-slider-track" id="texture-slider-track">
                    <span class="texture-label active" id="label-color">COLOR</span>
                    <div class="texture-track-bar">
                        <div class="texture-track-fill" id="texture-track-fill"></div>
                    </div>
                    <span class="texture-label" id="label-texture">TEXTURE</span>
                </div>
            </div>
            <div class="card-controls">
                <button class="card-control-btn" id="zoom-out-btn" aria-label="Zoom out">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                        <circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/><line x1="8" y1="11" x2="14" y2="11"/>
                    </svg>
                </button>
                <button class="card-control-btn" id="zoom-in-btn" aria-label="Zoom in">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                        <circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/><line x1="11" y1="8" x2="11" y2="14"/><line x1="8" y1="11" x2="14" y2="11"/>
                    </svg>
                </button>
            </div>
            <p class="zoom-hint">Pinch to zoom • Double-tap to toggle</p>
        </section>

        <!-- Details Section -->
        <section class="details-section" aria-label="Card verification details">
            <!-- Verification Status -->
            <div class="verification-card">
                <div class="verification-header">
                    <div class="verification-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                            <polyline points="22 4 12 14.01 9 11.01"/>
                        </svg>
                    </div>
                    <div>
                        <div class="verification-title">Verified Digital Twin</div>
                        <div class="verification-subtitle">Permanently recorded</div>
                    </div>
                </div>
                <div class="timestamp-display">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                        <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                    </svg>
                    <div>
                        <span class="timestamp-label">Locked on</span>
                        <span class="timestamp-text" id="display-timestamp">—</span>
                    </div>
                </div>
            </div>

            <!-- Card Information -->
            <div class="info-card" id="info-card">
                <div class="info-card-title">Card Details</div>
                <h1 class="card-title" id="display-name">—</h1>
                <p class="card-subtitle" id="display-set">—</p>
                
                <div class="info-row" id="row-number">
                    <span class="info-label">Number</span>
                    <span class="info-value" id="display-number">—</span>
                </div>
                <div class="info-row" id="row-language">
                    <span class="info-label">Language</span>
                    <span class="info-value" id="display-language">—</span>
                </div>
                <div class="info-row" id="row-edition">
                    <span class="info-label">Edition</span>
                    <span class="info-value" id="display-edition">—</span>
                </div>
                <div class="info-row" id="row-grade">
                    <span class="info-label">Grade</span>
                    <span class="info-value"><span class="grade-badge" id="display-grade">—</span></span>
                </div>
            </div>

            <!-- Condition Notes -->
            <div class="notes-card hidden" id="notes-card">
                <div class="notes-title">Condition Notes</div>
                <p class="notes-text" id="display-notes"></p>
            </div>

            <!-- Marketplace Links -->
            <div class="links-card hidden" id="links-card">
                <div class="links-title">Marketplace Links</div>
                <div class="links-grid">
                    <a href="#" class="link-btn hidden" id="link-ebay" target="_blank" rel="noopener noreferrer">
                        <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                            <rect x="3" y="3" width="18" height="18" rx="3"/>
                        </svg>
                        <span>eBay</span>
                        <svg class="link-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                            <path d="M7 17L17 7M17 7H7M17 7v10"/>
                        </svg>
                    </a>
                    <a href="#" class="link-btn hidden" id="link-facebook" target="_blank" rel="noopener noreferrer">
                        <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                            <circle cx="12" cy="12" r="10"/>
                        </svg>
                        <span>Facebook Marketplace</span>
                        <svg class="link-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                            <path d="M7 17L17 7M17 7H7M17 7v10"/>
                        </svg>
                    </a>
                    <a href="#" class="link-btn hidden" id="link-tcgplayer" target="_blank" rel="noopener noreferrer">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                            <rect x="2" y="3" width="20" height="14" rx="2"/>
                        </svg>
                        <span>TCGPlayer</span>
                        <svg class="link-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                            <path d="M7 17L17 7M17 7H7M17 7v10"/>
                        </svg>
                    </a>
                    <a href="#" class="link-btn hidden" id="link-mercari" target="_blank" rel="noopener noreferrer">
                        <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                            <circle cx="12" cy="12" r="10"/>
                        </svg>
                        <span>Mercari</span>
                        <svg class="link-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                            <path d="M7 17L17 7M17 7H7M17 7v10"/>
                        </svg>
                    </a>
                    <a href="#" class="link-btn hidden" id="link-other" target="_blank" rel="noopener noreferrer">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                            <circle cx="12" cy="12" r="10"/>
                            <line x1="2" y1="12" x2="22" y2="12"/>
                        </svg>
                        <span>Other Link</span>
                        <svg class="link-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                            <path d="M7 17L17 7M17 7H7M17 7v10"/>
                        </svg>
                    </a>
                </div>
            </div>

            <!-- Paper Fingerprint Hint -->
            <div class="fingerprint-hint">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                    <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                </svg>
                <p class="fingerprint-hint-text">
                    This card's unique paper fiber pattern has been recorded. Future scans can verify authenticity by matching the microscopic surface texture.
                </p>
            </div>
        </section>
    </main>

    <!-- Fullscreen Overlay -->
    <div class="fullscreen-overlay" id="fullscreen-overlay" role="dialog" aria-modal="true" aria-label="Fullscreen card viewer">
        <div class="fullscreen-header">
            <span class="fullscreen-title">Inspect Card</span>
            <button class="fullscreen-close" id="fullscreen-close" aria-label="Exit fullscreen">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18"/>
                    <line x1="6" y1="6" x2="18" y2="18"/>
                </svg>
            </button>
        </div>
        <div class="fullscreen-card-area" id="fullscreen-card-area">
            <div class="fullscreen-card-wrapper" id="fullscreen-card-wrapper">
                <div class="card-canvas" id="fullscreen-card-canvas">
                    <img class="card-layer layer-base" id="fs-layer-base" alt="" src="" loading="eager">
                    <img class="card-layer layer-north" id="fs-layer-north" alt="" src="" loading="eager">
                    <img class="card-layer layer-south" id="fs-layer-south" alt="" src="" loading="eager">
                    <img class="card-layer layer-east" id="fs-layer-east" alt="" src="" loading="eager">
                    <img class="card-layer layer-west" id="fs-layer-west" alt="" src="" loading="eager">
                    <img class="card-layer texture-layer" id="fs-texture-layer" alt="" src="" loading="eager">
                </div>
                <div class="texture-slider" id="fs-texture-slider" role="slider" aria-label="Texture reveal slider" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0"></div>
            </div>
        </div>
        <div class="fullscreen-controls">
            <div class="fullscreen-texture-slider">
                <span class="texture-label active" id="fs-label-color">COLOR</span>
                <div class="texture-track-bar">
                    <div class="texture-track-fill" id="fs-texture-track-fill"></div>
                </div>
                <span class="texture-label" id="fs-label-texture">TEXTURE</span>
            </div>
            <div class="fullscreen-zoom-controls">
                <button class="fullscreen-zoom-btn" id="fs-zoom-out" aria-label="Zoom out">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/><line x1="8" y1="11" x2="14" y2="11"/>
                    </svg>
                </button>
                <span class="fullscreen-zoom-level" id="fs-zoom-level">1.0×</span>
                <button class="fullscreen-zoom-btn" id="fs-zoom-in" aria-label="Zoom in">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/><line x1="11" y1="8" x2="11" y2="14"/><line x1="8" y1="11" x2="14" y2="11"/>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Overlays -->
    <div class="light-glow" id="light-glow" aria-hidden="true"></div>
    <div class="zoom-pill" id="zoom-pill" aria-live="polite">1.0×</div>
    <div class="toast" id="toast">Link copied to clipboard</div>

    <!-- ============================================
         JAVASCRIPT
         ============================================ -->
    <script>
/**
 * Lumina Locked Controller
 * Read-only verification display
 */
const Lumina = (function() {
    'use strict';

    // ============================================
    // CONFIGURATION
    // ============================================
    const CONFIG = {
        minZoom: 1,
        maxZoom: 5,
        doubleTapDelay: 300,
        doubleTapDistance: 30
    };

    // Language and edition maps
    const LANGUAGE_MAP = {
        'EN': 'English', 'JP': 'Japanese', 'KR': 'Korean', 'ZH': 'Chinese',
        'DE': 'German', 'FR': 'French', 'IT': 'Italian', 'ES': 'Spanish', 'PT': 'Portuguese'
    };

    const EDITION_MAP = {
        'UNL': 'Unlimited', '1ST': '1st Edition', 'SHD': 'Shadowless', 'PRO': 'Promo'
    };

    const GRADE_MAP = {
        'M': 'Mint', 'NM': 'Near Mint', 'LP': 'Lightly Played',
        'MP': 'Moderately Played', 'HP': 'Heavily Played', 'DMG': 'Damaged'
    };

    // ============================================
    // STATE
    // ============================================
    const state = {
        zoom: 1,
        panX: 0,
        panY: 0,
        isPanning: false,
        lastX: 0,
        lastY: 0,
        initialPinchDistance: 0,
        initialPinchZoom: 1,
        lastTapTime: 0,
        lastTapX: 0,
        lastTapY: 0
    };

    // ============================================
    // DOM REFERENCES
    // ============================================
    let elements = {};

    // ============================================
    // UTILITY FUNCTIONS
    // ============================================
    const utils = {
        vibrate(pattern) {
            if (navigator.vibrate) navigator.vibrate(pattern);
        },

        safeLocalStorage(action, key) {
            try {
                if (action === 'get') return localStorage.getItem(key);
            } catch (e) {
                console.error('localStorage error:', e);
                return null;
            }
        }
    };

    // ============================================
    // CARD VIEWER MODULE
    // ============================================
    const cardViewer = {
        layers: {},

        init() {
            this.layers = {
                north: document.getElementById('layer-north'),
                south: document.getElementById('layer-south'),
                east: document.getElementById('layer-east'),
                west: document.getElementById('layer-west')
            };
        },

        setZoom(newZoom, centerX = null, centerY = null, animate = false) {
            const oldZoom = state.zoom;
            state.zoom = Math.max(CONFIG.minZoom, Math.min(CONFIG.maxZoom, newZoom));
            
            if (centerX !== null && centerY !== null && state.zoom !== oldZoom) {
                const rect = elements.cardWrapper.getBoundingClientRect();
                const relX = (centerX - rect.left) / rect.width - 0.5;
                const relY = (centerY - rect.top) / rect.height - 0.5;
                const zoomDelta = state.zoom - oldZoom;
                state.panX -= relX * zoomDelta * 100;
                state.panY -= relY * zoomDelta * 100;
            }
            
            if (state.zoom === 1) { state.panX = 0; state.panY = 0; }
            this.constrainPan();
            
            if (animate) {
                elements.cardCanvas.classList.add('animating');
                setTimeout(() => elements.cardCanvas.classList.remove('animating'), 150);
            }
            
            this.applyTransform();
            this.updateZoomPill();
        },

        constrainPan() {
            if (state.zoom <= 1) { state.panX = 0; state.panY = 0; return; }
            const maxPan = (state.zoom - 1) * 50;
            state.panX = Math.max(-maxPan, Math.min(maxPan, state.panX));
            state.panY = Math.max(-maxPan, Math.min(maxPan, state.panY));
        },

        applyTransform() {
            elements.cardCanvas.style.transform = `scale(${state.zoom}) translate(${state.panX / state.zoom}%, ${state.panY / state.zoom}%)`;
        },

        updateZoomPill() {
            elements.zoomPill.textContent = `${state.zoom.toFixed(1)}×`;
            elements.zoomPill.classList.toggle('visible', state.zoom > 1);
        },

        updateLight(x, y) {
            const rect = elements.cardWrapper.getBoundingClientRect();
            const px = Math.max(0, Math.min(1, (x - rect.left) / rect.width));
            const py = Math.max(0, Math.min(1, (y - rect.top) / rect.height));

            elements.lightGlow.style.left = x + 'px';
            elements.lightGlow.style.top = y + 'px';
            elements.lightGlow.classList.add('visible');

            const dx = (px - 0.5) * 2;
            const dy = (py - 0.5) * 2;

            this.layers.north.style.opacity = Math.min(1, Math.max(0, -dy) * 1.4);
            this.layers.south.style.opacity = Math.min(1, Math.max(0, dy) * 1.4);
            this.layers.east.style.opacity = Math.min(1, Math.max(0, dx) * 1.4);
            this.layers.west.style.opacity = Math.min(1, Math.max(0, -dx) * 1.4);
        },

        resetLight() {
            elements.lightGlow.classList.remove('visible');
            Object.values(this.layers).forEach(l => l.style.opacity = 0);
        },

        getPinchDistance(touches) {
            const dx = touches[0].clientX - touches[1].clientX;
            const dy = touches[0].clientY - touches[1].clientY;
            return Math.sqrt(dx * dx + dy * dy);
        },

        getPinchCenter(touches) {
            return {
                x: (touches[0].clientX + touches[1].clientX) / 2,
                y: (touches[0].clientY + touches[1].clientY) / 2
            };
        },

        loadImages(imageData) {
            const layers = ['base', 'north', 'south', 'east', 'west'];
            let loadedCount = 0;

            layers.forEach(layer => {
                const img = document.getElementById(`layer-${layer}`);
                if (imageData[layer]) {
                    img.onload = () => {
                        loadedCount++;
                        if (loadedCount === layers.length) {
                            document.getElementById('card-placeholder').style.display = 'none';
                            // Set texture layer
                            const textureLayer = document.getElementById('texture-layer');
                            if (textureLayer) textureLayer.src = imageData.base;
                        }
                    };
                    img.src = imageData[layer];
                }
            });
        }
    };

    // ============================================
    // TEXTURE SLIDER MODULE
    // ============================================
    const textureSlider = {
        position: 0,
        isDragging: false,
        activeContext: 'main',

        init() {
            this.setupSlider('main');
        },

        setupSlider(context) {
            const prefix = context === 'fullscreen' ? 'fs-' : '';
            const wrapper = document.getElementById(context === 'fullscreen' ? 'fullscreen-card-wrapper' : 'card-wrapper');
            const slider = document.getElementById(prefix + 'texture-slider');
            
            if (!slider || !wrapper) return;

            slider.addEventListener('mousedown', (e) => this.startDrag(e, context));
            slider.addEventListener('touchstart', (e) => this.startDrag(e, context), { passive: false });
            
            const track = document.getElementById(context === 'fullscreen' ? 'fullscreen-controls' : 'texture-slider-track');
            if (track) {
                track.addEventListener('click', (e) => {
                    if (e.target.closest('.texture-track-bar')) {
                        const bar = e.target.closest('.texture-track-bar');
                        const rect = bar.getBoundingClientRect();
                        const pos = ((e.clientX - rect.left) / rect.width) * 100;
                        this.setPosition(Math.max(0, Math.min(100, pos)), context);
                    }
                });
            }
        },

        startDrag(e, context) {
            e.preventDefault();
            this.isDragging = true;
            this.activeContext = context;
            
            const wrapper = document.getElementById(context === 'fullscreen' ? 'fullscreen-card-wrapper' : 'card-wrapper');
            wrapper.classList.add('slider-active');
            
            document.addEventListener('mousemove', this.handleDrag);
            document.addEventListener('mouseup', this.stopDrag);
            document.addEventListener('touchmove', this.handleDrag, { passive: false });
            document.addEventListener('touchend', this.stopDrag);
        },

        handleDrag: (e) => {
            if (!textureSlider.isDragging) return;
            e.preventDefault();
            
            const context = textureSlider.activeContext;
            const wrapper = document.getElementById(context === 'fullscreen' ? 'fullscreen-card-wrapper' : 'card-wrapper');
            const rect = wrapper.getBoundingClientRect();
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const pos = ((clientX - rect.left) / rect.width) * 100;
            textureSlider.setPosition(Math.max(0, Math.min(100, pos)), context);
        },

        stopDrag: () => {
            if (!textureSlider.isDragging) return;
            textureSlider.isDragging = false;
            
            const wrapper = document.getElementById(textureSlider.activeContext === 'fullscreen' ? 'fullscreen-card-wrapper' : 'card-wrapper');
            wrapper.classList.remove('slider-active');
            
            document.removeEventListener('mousemove', textureSlider.handleDrag);
            document.removeEventListener('mouseup', textureSlider.stopDrag);
            document.removeEventListener('touchmove', textureSlider.handleDrag);
            document.removeEventListener('touchend', textureSlider.stopDrag);
        },

        setPosition(pos, context = 'main') {
            this.position = pos;
            
            ['main', 'fullscreen'].forEach(ctx => {
                const prefix = ctx === 'fullscreen' ? 'fs-' : '';
                const slider = document.getElementById(prefix + 'texture-slider');
                const texture = document.getElementById(prefix + 'texture-layer');
                const fill = document.getElementById(prefix + 'texture-track-fill');
                const labelColor = document.getElementById(prefix + 'label-color');
                const labelTexture = document.getElementById(prefix + 'label-texture');
                
                if (slider) {
                    slider.style.left = pos + '%';
                    slider.setAttribute('aria-valuenow', Math.round(pos));
                }
                if (texture) texture.style.clipPath = `inset(0 ${100 - pos}% 0 0)`;
                if (fill) fill.style.width = pos + '%';
                if (labelColor) labelColor.classList.toggle('active', pos < 50);
                if (labelTexture) labelTexture.classList.toggle('active', pos >= 50);
            });
        }
    };

    // ============================================
    // FULLSCREEN MODULE
    // ============================================
    const fullscreen = {
        isActive: false,
        previousFocus: null,
        fsState: { zoom: 1, panX: 0, panY: 0 },

        init() {
            this.setupCardInteractions();
        },

        enter() {
            this.isActive = true;
            this.previousFocus = document.activeElement;
            
            document.body.classList.add('fullscreen-active');
            document.getElementById('fullscreen-overlay').classList.add('active');
            
            ['base', 'north', 'south', 'east', 'west'].forEach(layer => {
                const src = document.getElementById(`layer-${layer}`).src;
                document.getElementById(`fs-layer-${layer}`).src = src;
            });
            
            const textureSrc = document.getElementById('texture-layer').src;
            document.getElementById('fs-texture-layer').src = textureSrc;
            
            textureSlider.setupSlider('fullscreen');
            this.fsState = { zoom: 1, panX: 0, panY: 0 };
            this.applyTransform();
            this.updateZoomLevel();
            
            document.getElementById('fullscreen-close').focus();
            
            if (document.documentElement.requestFullscreen) {
                document.documentElement.requestFullscreen().catch(() => {});
            } else if (document.documentElement.webkitRequestFullscreen) {
                document.documentElement.webkitRequestFullscreen();
            }
            
            utils.vibrate(10);
        },

        exit() {
            this.isActive = false;
            document.body.classList.remove('fullscreen-active');
            document.getElementById('fullscreen-overlay').classList.remove('active');
            
            if (document.exitFullscreen) {
                document.exitFullscreen().catch(() => {});
            } else if (document.webkitExitFullscreen) {
                document.webkitExitFullscreen();
            }
            
            if (this.previousFocus) this.previousFocus.focus();
        },

        setupCardInteractions() {
            const wrapper = document.getElementById('fullscreen-card-wrapper');
            const canvas = document.getElementById('fullscreen-card-canvas');
            if (!wrapper || !canvas) return;

            const fsLayers = {
                north: document.getElementById('fs-layer-north'),
                south: document.getElementById('fs-layer-south'),
                east: document.getElementById('fs-layer-east'),
                west: document.getElementById('fs-layer-west')
            };

            let isPanning = false, lastX = 0, lastY = 0;
            let lastTapTime = 0, lastTapX = 0, lastTapY = 0;
            let initialPinchDistance = 0, initialPinchZoom = 1;

            const updateLight = (x, y) => {
                const rect = wrapper.getBoundingClientRect();
                const px = Math.max(0, Math.min(1, (x - rect.left) / rect.width));
                const py = Math.max(0, Math.min(1, (y - rect.top) / rect.height));
                const dx = (px - 0.5) * 2, dy = (py - 0.5) * 2;

                fsLayers.north.style.opacity = Math.min(1, Math.max(0, -dy) * 1.4);
                fsLayers.south.style.opacity = Math.min(1, Math.max(0, dy) * 1.4);
                fsLayers.east.style.opacity = Math.min(1, Math.max(0, dx) * 1.4);
                fsLayers.west.style.opacity = Math.min(1, Math.max(0, -dx) * 1.4);
            };

            const resetLight = () => Object.values(fsLayers).forEach(l => l.style.opacity = 0);

            const getPinchDistance = (touches) => {
                const dx = touches[0].clientX - touches[1].clientX;
                const dy = touches[0].clientY - touches[1].clientY;
                return Math.sqrt(dx * dx + dy * dy);
            };

            wrapper.addEventListener('touchstart', e => {
                if (textureSlider.isDragging) return;
                
                if (e.touches.length === 1) {
                    const touch = e.touches[0];
                    const now = Date.now();
                    const dx = touch.clientX - lastTapX, dy = touch.clientY - lastTapY;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (now - lastTapTime < CONFIG.doubleTapDelay && distance < CONFIG.doubleTapDistance) {
                        e.preventDefault();
                        this.setZoom(this.fsState.zoom > 1 ? 1 : 3, touch.clientX, touch.clientY, true);
                        utils.vibrate(10);
                        lastTapTime = 0;
                    } else {
                        lastTapTime = now;
                        lastTapX = touch.clientX;
                        lastTapY = touch.clientY;
                        isPanning = true;
                        lastX = touch.clientX;
                        lastY = touch.clientY;
                        updateLight(lastX, lastY);
                    }
                } else if (e.touches.length === 2) {
                    isPanning = false;
                    initialPinchDistance = getPinchDistance(e.touches);
                    initialPinchZoom = this.fsState.zoom;
                }
            }, { passive: false });

            wrapper.addEventListener('touchmove', e => {
                if (textureSlider.isDragging) return;
                e.preventDefault();
                
                if (e.touches.length === 1 && isPanning) {
                    const t = e.touches[0];
                    updateLight(t.clientX, t.clientY);
                    
                    if (this.fsState.zoom > 1) {
                        const rect = wrapper.getBoundingClientRect();
                        this.fsState.panX += (t.clientX - lastX) / rect.width * 100;
                        this.fsState.panY += (t.clientY - lastY) / rect.height * 100;
                        this.constrainPan();
                        this.applyTransform();
                    }
                    lastX = t.clientX;
                    lastY = t.clientY;
                } else if (e.touches.length === 2) {
                    const currentDistance = getPinchDistance(e.touches);
                    const center = {
                        x: (e.touches[0].clientX + e.touches[1].clientX) / 2,
                        y: (e.touches[0].clientY + e.touches[1].clientY) / 2
                    };
                    this.setZoom(initialPinchZoom * (currentDistance / initialPinchDistance), center.x, center.y);
                }
            }, { passive: false });

            wrapper.addEventListener('touchend', e => {
                if (e.touches.length === 0) { isPanning = false; resetLight(); }
                else if (e.touches.length === 1) { lastX = e.touches[0].clientX; lastY = e.touches[0].clientY; isPanning = true; }
            }, { passive: true });

            let lastClickTime = 0;
            wrapper.addEventListener('mousedown', e => {
                if (textureSlider.isDragging) return;
                const now = Date.now();
                if (now - lastClickTime < CONFIG.doubleTapDelay) {
                    this.setZoom(this.fsState.zoom > 1 ? 1 : 3, e.clientX, e.clientY, true);
                    lastClickTime = 0;
                } else { lastClickTime = now; isPanning = true; lastX = e.clientX; lastY = e.clientY; }
            });

            wrapper.addEventListener('mousemove', e => {
                if (textureSlider.isDragging) return;
                updateLight(e.clientX, e.clientY);
                if (isPanning && this.fsState.zoom > 1 && e.buttons === 1) {
                    const rect = wrapper.getBoundingClientRect();
                    this.fsState.panX += (e.clientX - lastX) / rect.width * 100;
                    this.fsState.panY += (e.clientY - lastY) / rect.height * 100;
                    this.constrainPan();
                    this.applyTransform();
                    lastX = e.clientX;
                    lastY = e.clientY;
                }
            });

            wrapper.addEventListener('mouseup', () => isPanning = false);
            wrapper.addEventListener('mouseleave', () => { isPanning = false; resetLight(); });
            wrapper.addEventListener('wheel', e => { e.preventDefault(); this.setZoom(this.fsState.zoom + (e.deltaY < 0 ? 0.5 : -0.5), e.clientX, e.clientY); }, { passive: false });
        },

        setZoom(newZoom, centerX = null, centerY = null, animate = false) {
            const oldZoom = this.fsState.zoom;
            this.fsState.zoom = Math.max(CONFIG.minZoom, Math.min(CONFIG.maxZoom, newZoom));
            
            if (centerX !== null && centerY !== null && this.fsState.zoom !== oldZoom) {
                const wrapper = document.getElementById('fullscreen-card-wrapper');
                const rect = wrapper.getBoundingClientRect();
                const relX = (centerX - rect.left) / rect.width - 0.5;
                const relY = (centerY - rect.top) / rect.height - 0.5;
                const zoomDelta = this.fsState.zoom - oldZoom;
                this.fsState.panX -= relX * zoomDelta * 100;
                this.fsState.panY -= relY * zoomDelta * 100;
            }
            
            if (this.fsState.zoom === 1) { this.fsState.panX = 0; this.fsState.panY = 0; }
            this.constrainPan();
            
            const canvas = document.getElementById('fullscreen-card-canvas');
            if (animate) { canvas.classList.add('animating'); setTimeout(() => canvas.classList.remove('animating'), 150); }
            
            this.applyTransform();
            this.updateZoomLevel();
        },

        constrainPan() {
            if (this.fsState.zoom <= 1) { this.fsState.panX = 0; this.fsState.panY = 0; return; }
            const maxPan = (this.fsState.zoom - 1) * 50;
            this.fsState.panX = Math.max(-maxPan, Math.min(maxPan, this.fsState.panX));
            this.fsState.panY = Math.max(-maxPan, Math.min(maxPan, this.fsState.panY));
        },

        applyTransform() {
            const canvas = document.getElementById('fullscreen-card-canvas');
            canvas.style.transform = `scale(${this.fsState.zoom}) translate(${this.fsState.panX / this.fsState.zoom}%, ${this.fsState.panY / this.fsState.zoom}%)`;
        },

        updateZoomLevel() {
            document.getElementById('fs-zoom-level').textContent = `${this.fsState.zoom.toFixed(1)}×`;
        }
    };

    // ============================================
    // DEMO IMAGE GENERATOR (for testing)
    // ============================================
    const demoImages = {
        generateLayer(direction, width = 400, height = 557) {
            const canvas = document.createElement('canvas');
            canvas.width = width;
            canvas.height = height;
            const ctx = canvas.getContext('2d');

            const baseColor = '#2a4a6a';
            ctx.fillStyle = baseColor;
            ctx.fillRect(0, 0, width, height);

            let gradient;
            switch (direction) {
                case 'base':
                    gradient = ctx.createRadialGradient(width/2, height/2, 0, width/2, height/2, width/2);
                    gradient.addColorStop(0, 'rgba(255,255,255,0.1)');
                    gradient.addColorStop(1, 'rgba(0,0,0,0.1)');
                    break;
                case 'north':
                    gradient = ctx.createLinearGradient(0, 0, 0, height);
                    gradient.addColorStop(0, 'rgba(255,255,255,0.4)');
                    gradient.addColorStop(0.5, 'rgba(255,255,255,0.1)');
                    gradient.addColorStop(1, 'rgba(0,0,0,0.2)');
                    break;
                case 'south':
                    gradient = ctx.createLinearGradient(0, height, 0, 0);
                    gradient.addColorStop(0, 'rgba(255,255,255,0.4)');
                    gradient.addColorStop(0.5, 'rgba(255,255,255,0.1)');
                    gradient.addColorStop(1, 'rgba(0,0,0,0.2)');
                    break;
                case 'east':
                    gradient = ctx.createLinearGradient(width, 0, 0, 0);
                    gradient.addColorStop(0, 'rgba(255,255,255,0.4)');
                    gradient.addColorStop(0.5, 'rgba(255,255,255,0.1)');
                    gradient.addColorStop(1, 'rgba(0,0,0,0.2)');
                    break;
                case 'west':
                    gradient = ctx.createLinearGradient(0, 0, width, 0);
                    gradient.addColorStop(0, 'rgba(255,255,255,0.4)');
                    gradient.addColorStop(0.5, 'rgba(255,255,255,0.1)');
                    gradient.addColorStop(1, 'rgba(0,0,0,0.2)');
                    break;
            }
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, width, height);

            ctx.strokeStyle = 'rgba(255,255,255,0.3)';
            ctx.lineWidth = 8;
            ctx.strokeRect(12, 12, width - 24, height - 24);

            ctx.strokeStyle = 'rgba(255,255,255,0.15)';
            ctx.lineWidth = 2;
            ctx.strokeRect(24, 24, width - 48, height - 48);

            ctx.fillStyle = 'rgba(0,0,0,0.2)';
            ctx.fillRect(32, 60, width - 64, height * 0.45);

            if (direction !== 'base') {
                ctx.fillStyle = 'rgba(255,255,255,0.15)';
                const artX = 32, artY = 60, artW = width - 64, artH = height * 0.45;
                switch (direction) {
                    case 'north': ctx.fillRect(artX, artY, artW, artH * 0.3); break;
                    case 'south': ctx.fillRect(artX, artY + artH * 0.7, artW, artH * 0.3); break;
                    case 'east': ctx.fillRect(artX + artW * 0.7, artY, artW * 0.3, artH); break;
                    case 'west': ctx.fillRect(artX, artY, artW * 0.3, artH); break;
                }
            }

            ctx.fillStyle = 'rgba(255,255,255,0.08)';
            ctx.fillRect(32, 20, width - 64, 32);

            ctx.fillStyle = 'rgba(0,0,0,0.15)';
            ctx.fillRect(32, height * 0.58, width - 64, height * 0.32);

            ctx.fillStyle = 'rgba(34, 197, 94, 0.6)';
            ctx.font = 'bold 14px system-ui';
            ctx.textAlign = 'center';
            ctx.fillText('✓ VERIFIED', width / 2, height - 20);

            return canvas.toDataURL('image/jpeg', 0.85);
        },

        generateAll() {
            return {
                base: this.generateLayer('base'),
                north: this.generateLayer('north'),
                south: this.generateLayer('south'),
                east: this.generateLayer('east'),
                west: this.generateLayer('west')
            };
        }
    };

    function loadImagesWithFallback() {
        const testImg = new Image();
        testImg.onload = () => {
            cardViewer.loadImages({
                base: 'images/base.JPG',
                north: 'images/north.JPG',
                south: 'images/south.JPG',
                east: 'images/east.JPG',
                west: 'images/west.JPG'
            });
        };
        testImg.onerror = () => {
            // Try lowercase
            const testImg2 = new Image();
            testImg2.onload = () => {
                cardViewer.loadImages({
                    base: 'images/base.jpg',
                    north: 'images/north.jpg',
                    south: 'images/south.jpg',
                    east: 'images/east.jpg',
                    west: 'images/west.jpg'
                });
            };
            testImg2.onerror = () => {
                cardViewer.loadImages(demoImages.generateAll());
            };
            testImg2.src = 'images/base.jpg';
        };
        testImg.src = 'images/base.JPG';
    }

    // ============================================
    // DATA DISPLAY MODULE
    // ============================================
    const dataDisplay = {
        loadData() {
            const raw = utils.safeLocalStorage('get', 'lumina-card-data');
            if (!raw) {
                console.warn('No card data found');
                return null;
            }
            
            try {
                return JSON.parse(raw);
            } catch (e) {
                console.error('Failed to parse card data:', e);
                return null;
            }
        },

        render(data) {
            if (!data) return;

            // Basic info
            document.getElementById('display-name').textContent = data.name || 'Untitled Card';
            document.getElementById('display-set').textContent = data.set || 'Unknown Set';
            document.getElementById('display-timestamp').textContent = data.timestamp || '—';

            // Number
            if (data.number) {
                document.getElementById('display-number').textContent = data.number;
            } else {
                document.getElementById('row-number').classList.add('hidden');
            }

            // Language
            if (data.language) {
                document.getElementById('display-language').textContent = LANGUAGE_MAP[data.language] || data.language;
            } else {
                document.getElementById('row-language').classList.add('hidden');
            }

            // Edition
            if (data.edition) {
                document.getElementById('display-edition').textContent = EDITION_MAP[data.edition] || data.edition;
            } else {
                document.getElementById('row-edition').classList.add('hidden');
            }

            // Grade
            if (data.grade) {
                document.getElementById('display-grade').textContent = GRADE_MAP[data.grade] || data.grade;
            } else {
                document.getElementById('row-grade').classList.add('hidden');
            }

            // Notes
            if (data.notes && data.notes.trim()) {
                document.getElementById('display-notes').textContent = data.notes;
                document.getElementById('notes-card').classList.remove('hidden');
            }

            // Links
            const links = data.links || {};
            let hasLinks = false;

            ['ebay', 'facebook', 'tcgplayer', 'mercari', 'other'].forEach(platform => {
                const url = links[platform];
                const linkEl = document.getElementById('link-' + platform);
                if (url && url.trim()) {
                    linkEl.href = url;
                    linkEl.classList.remove('hidden');
                    hasLinks = true;
                }
            });

            if (hasLinks) {
                document.getElementById('links-card').classList.remove('hidden');
            }
        }
    };

    // ============================================
    // EVENT HANDLERS
    // ============================================
    function setupEventListeners() {
        // Touch handlers
        elements.cardWrapper.addEventListener('touchstart', e => {
            if (e.touches.length === 1) {
                const touch = e.touches[0];
                const now = Date.now();
                const dx = touch.clientX - state.lastTapX;
                const dy = touch.clientY - state.lastTapY;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (now - state.lastTapTime < CONFIG.doubleTapDelay && distance < CONFIG.doubleTapDistance) {
                    e.preventDefault();
                    const newZoom = state.zoom > 1 ? 1 : 3;
                    cardViewer.setZoom(newZoom, touch.clientX, touch.clientY, true);
                    utils.vibrate(10);
                    state.lastTapTime = 0;
                } else {
                    state.lastTapTime = now;
                    state.lastTapX = touch.clientX;
                    state.lastTapY = touch.clientY;
                    state.isPanning = true;
                    state.lastX = touch.clientX;
                    state.lastY = touch.clientY;
                    cardViewer.updateLight(state.lastX, state.lastY);
                }
            } else if (e.touches.length === 2) {
                state.isPanning = false;
                state.initialPinchDistance = cardViewer.getPinchDistance(e.touches);
                state.initialPinchZoom = state.zoom;
            }
        }, { passive: false });

        elements.cardWrapper.addEventListener('touchmove', e => {
            e.preventDefault();
            
            if (e.touches.length === 1 && state.isPanning) {
                const t = e.touches[0];
                cardViewer.updateLight(t.clientX, t.clientY);
                
                if (state.zoom > 1) {
                    const rect = elements.cardWrapper.getBoundingClientRect();
                    state.panX += (t.clientX - state.lastX) / rect.width * 100;
                    state.panY += (t.clientY - state.lastY) / rect.height * 100;
                    cardViewer.constrainPan();
                    cardViewer.applyTransform();
                }
                state.lastX = t.clientX;
                state.lastY = t.clientY;
                
            } else if (e.touches.length === 2) {
                const currentDistance = cardViewer.getPinchDistance(e.touches);
                const center = cardViewer.getPinchCenter(e.touches);
                const scale = currentDistance / state.initialPinchDistance;
                cardViewer.setZoom(state.initialPinchZoom * scale, center.x, center.y);
            }
        }, { passive: false });

        elements.cardWrapper.addEventListener('touchend', e => {
            if (e.touches.length === 0) {
                state.isPanning = false;
                cardViewer.resetLight();
            } else if (e.touches.length === 1) {
                state.lastX = e.touches[0].clientX;
                state.lastY = e.touches[0].clientY;
                state.isPanning = true;
            }
        }, { passive: true });

        // Mouse handlers
        let lastClickTime = 0;

        elements.cardWrapper.addEventListener('mousedown', e => {
            const now = Date.now();
            if (now - lastClickTime < CONFIG.doubleTapDelay) {
                const newZoom = state.zoom > 1 ? 1 : 3;
                cardViewer.setZoom(newZoom, e.clientX, e.clientY, true);
                lastClickTime = 0;
            } else {
                lastClickTime = now;
                state.isPanning = true;
                state.lastX = e.clientX;
                state.lastY = e.clientY;
            }
        });

        elements.cardWrapper.addEventListener('mousemove', e => {
            cardViewer.updateLight(e.clientX, e.clientY);
            if (state.isPanning && state.zoom > 1 && e.buttons === 1) {
                const rect = elements.cardWrapper.getBoundingClientRect();
                state.panX += (e.clientX - state.lastX) / rect.width * 100;
                state.panY += (e.clientY - state.lastY) / rect.height * 100;
                cardViewer.constrainPan();
                cardViewer.applyTransform();
                state.lastX = e.clientX;
                state.lastY = e.clientY;
            }
        });

        elements.cardWrapper.addEventListener('mouseup', () => state.isPanning = false);
        elements.cardWrapper.addEventListener('mouseleave', () => {
            state.isPanning = false;
            cardViewer.resetLight();
        });

        elements.cardWrapper.addEventListener('wheel', e => {
            e.preventDefault();
            cardViewer.setZoom(state.zoom + (e.deltaY < 0 ? 0.5 : -0.5), e.clientX, e.clientY);
        }, { passive: false });

        // Zoom buttons
        document.getElementById('zoom-in-btn').addEventListener('click', () => {
            cardViewer.setZoom(state.zoom + 0.5, null, null, true);
            utils.vibrate(5);
        });
        
        document.getElementById('zoom-out-btn').addEventListener('click', () => {
            cardViewer.setZoom(state.zoom - 0.5, null, null, true);
            utils.vibrate(5);
        });

        // Share button
        document.getElementById('share-btn').addEventListener('click', async () => {
            utils.vibrate(5);
            const title = document.getElementById('display-name').textContent + ' - Lumina Verified';
            
            if (navigator.share) {
                try { 
                    await navigator.share({ title, url: location.href }); 
                } catch (e) {
                    // User cancelled or error
                }
            } else if (navigator.clipboard) {
                await navigator.clipboard.writeText(location.href);
                elements.toast.classList.add('visible');
                setTimeout(() => elements.toast.classList.remove('visible'), 2000);
            }
        });

        // Back button
        document.getElementById('back-btn').addEventListener('click', () => {
            window.location.href = 'lumina-draft.html';
        });
    }

    // ============================================
    // INITIALIZATION
    // ============================================
    function init() {
        // Cache DOM references
        elements = {
            cardWrapper: document.getElementById('card-wrapper'),
            cardCanvas: document.getElementById('card-canvas'),
            lightGlow: document.getElementById('light-glow'),
            zoomPill: document.getElementById('zoom-pill'),
            toast: document.getElementById('toast')
        };

        // Initialize modules
        cardViewer.init();
        textureSlider.init();
        fullscreen.init();
        
        // Load and render data
        const data = dataDisplay.loadData();
        dataDisplay.render(data);
        
        // Load images
        loadImagesWithFallback();
        
        // Setup events
        setupEventListeners();
        setupFullscreenEvents();

        // Global error handling
        window.addEventListener('error', e => console.error('Global error:', e.error));
        window.addEventListener('unhandledrejection', e => console.error('Unhandled rejection:', e.reason));
    }

    function setupFullscreenEvents() {
        document.getElementById('fullscreen-btn').addEventListener('click', () => fullscreen.enter());
        document.getElementById('fullscreen-close').addEventListener('click', () => fullscreen.exit());
        
        document.addEventListener('keydown', e => {
            if (e.key === 'Escape' && fullscreen.isActive) fullscreen.exit();
        });
        
        document.getElementById('fullscreen-card-area').addEventListener('click', e => {
            if (e.target.id === 'fullscreen-card-area') fullscreen.exit();
        });
        
        document.getElementById('fs-zoom-in').addEventListener('click', () => {
            fullscreen.setZoom(fullscreen.fsState.zoom + 0.5, null, null, true);
            utils.vibrate(5);
        });
        
        document.getElementById('fs-zoom-out').addEventListener('click', () => {
            fullscreen.setZoom(fullscreen.fsState.zoom - 0.5, null, null, true);
            utils.vibrate(5);
        });
    }

    // Initialize on DOM ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
    } else {
        init();
    }

    // Return public API
    return {
        getState: () => ({ ...state }),
        utils
    };
})();
    </script>
</body>
</html>
